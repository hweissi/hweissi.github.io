<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><title>
         CounterSEVeillance: Performance-Counter Attacks on AMD SEV-SNP
        
    </title><meta content="CounterSEVeillance: Performance-Counter Attacks on AMD SEV-SNP" property=og:title><link href=https://hannesweissteiner.xyz/fonts.css rel=stylesheet><script src=https://hannesweissteiner.xyz/js/codeblock.js></script><link title="Hannes Weissteiner" href=https://hannesweissteiner.xyz/atom.xml rel=alternate type=application/atom+xml><link href=https://hannesweissteiner.xyz/theme/light.css rel=stylesheet><link media="(prefers-color-scheme: dark)" href=https://hannesweissteiner.xyz/theme/dark.css rel=stylesheet><script src=https://hannesweissteiner.xyz/js/themetoggle.js></script><script>if(window.matchMedia(`(prefers-color-scheme: dark)`).matches){setTheme(`dark`)}else{setTheme(`light`)}</script><link href=https://hannesweissteiner.xyz/main.css media=screen rel=stylesheet><script src=https://hannesweissteiner.xyz/js/mermaid.js></script><body><div class=content><header><div class=main><a href=https://hannesweissteiner.xyz>Hannes Weissteiner</a><div class=socials><a class=social href=https://bsky.app/profile/hannesweissteiner.xyz rel=me> <img alt=BlueSky src=https://hannesweissteiner.xyz/social_icons/bluesky.svg> </a><a class=social href=https://github.com/hweissi/ rel=me> <img alt=GitHub src=https://hannesweissteiner.xyz/social_icons/github.svg> </a><a class=social href=https://infosec.exchange/@hweissi rel=me> <img alt=Mastodon src=https://hannesweissteiner.xyz/social_icons/mastodon.svg> </a><a class=social href=https://x.com/@hweissi rel=me> <img alt=X src=https://hannesweissteiner.xyz/social_icons/x-twitter.svg> </a><a class=social href=mailto:hannes.weissteiner@iaik.tugraz.at rel=me> <img alt=email src=https://hannesweissteiner.xyz/social_icons/email.svg> </a></div></div><nav><a href=https://hannesweissteiner.xyz style=margin-left:.5em>/about</a><a href=https://hannesweissteiner.xyz/publications style=margin-left:.5em>/publications</a></nav></header><main><article><div class=title><div class=page-header>CounterSEVeillance: Performance-Counter Attacks on AMD SEV-SNP<span class=primary-color style=font-size:1.6em>.</span></div><div class=meta>Posted on <time>2025-02-01</time></div></div><section class=body><h1 id=abstract>Abstract</h1><p>Confidential virtual machines (VMs) promise higher security by running the VM inside a trusted execution environment (TEE). Recent AMD server processors support confidential VMs with the SEV-SNP processor extension. SEV-SNP provides guarantees for integrity and confidentiality for confidential VMs despite running them in a shared hosting environment.<p>In this paper, we introduce CounterSEVeillance, a new sidechannel attack leaking secret-dependent control flow and operand properties from performance counter data. Our attack is the first to exploit performance counter side-channel leakage with single-instruction resolution from SEV-SNP VMs and works on fully patched systems. We systematically analyze performance counter events in SEV-SNP VMs and find that 228 are exposed to a potentially malicious hypervisor. CounterSEVeillance builds on this analysis and records performance counter traces with an instruction-level resolution by single-stepping the victim VM using APIC interrupts in combination with page faults. We match CounterSEVeillance traces against binaries, precisely recovering the outcome of any secret-dependent conditional branch and inferring operand properties. We present four attack case studies, in which we exemplarily showcase concrete exploitable leakage with 6 of the exposed performance counters. First, we use CounterSEVeillance to extract a full RSA-4096 key from a single Mbed TLS signature process in less than 8 minutes. Second, we present the first side-channel attack on TOTP verification running in an AMD SEV-SNP VM, recovering a 6-digit TOTP with only 31.1 guesses on average. Third, we show that CounterSEVeillance can leak the secret key from which the TOTPs are derived from the underlying base32 decoder. Fourth and finally, we show that CounterSEVeillance can also be used to construct a plaintext-checking oracle in a divide-and-surrender-style attack. We conclude that moving an entire VM into a setting with a privileged adversary increases the attack surface, given the vast amounts of code not vetted for this specific security setting.<p>[<a href=https://stefangast.eu/papers/counterseveillance.pdf>Read Paper</a>]<h1 id=cite>Cite</h1><pre class=language-bibtex data-lang=bibtex style=color:#f8f8f2;background-color:#191919><code class=language-bibtex data-lang=bibtex><span style=color:#ff5e5e>@inproceedings</span><span>{Gast2025CounterSEVeillance,
</span><span> </span><span style=color:#fbe3bf>author </span><span>= </span><span style=color:#fff>{</span><span style=color:#fbe3bf>Gast, Stefan and Weissteiner, Hannes and Schr√∂der, Robin Leander and Gruss, Daniel</span><span style=color:#fff>}</span><span>,
</span><span> </span><span style=color:#fbe3bf>booktitle </span><span>= </span><span style=color:#fff>{</span><span style=color:#fbe3bf>NDSS</span><span style=color:#fff>}</span><span>,
</span><span> </span><span style=color:#fbe3bf>title </span><span>= </span><span style=color:#fff>{</span><span style=color:#fbe3bf>{CounterSEVeillance: Performance-Counter Attacks on AMD SEV-SNP}</span><span style=color:#fff>}</span><span>,
</span><span> </span><span style=color:#fbe3bf>year </span><span>= </span><span style=color:#fff>{</span><span style=color:#fbe3bf>2025</span><span style=color:#fff>}
</span><span>}
</span></code></pre></section></article></main></div>